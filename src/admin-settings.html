<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin — App Settings</title>
  <link rel="stylesheet" href="./styles.css">
  <meta name="app-version" content="0.1.0">
</head>
<body>
  <header class="site-header">
    <h1>Admin — App Settings</h1>
    <nav><a href="admin.html">Dashboard</a> · <a href="admin-privacy.html">Privacy</a></nav>
  </header>

  <main class="page-content">
    <section class="card">
      <h2>App Settings (affects user & admin sites)</h2>
      <form id="appSettingsForm">
        <label>Site title
          <input id="siteTitle" name="siteTitle" type="text" placeholder="Site title">
        </label>

        <label>Default language
          <select id="defaultLang" name="defaultLang">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
          </select>
        </label>

        <label>
          <input id="maintenanceMode" name="maintenanceMode" type="checkbox"> Enable maintenance mode
        </label>

        <label>
          <input id="allowRegistration" name="allowRegistration" type="checkbox"> Allow user registration
        </label>

        <div style="margin-top:12px">
          <button id="saveAppSettings" class="btn">Save App Settings</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>Admin Defaults</h2>
      <form id="adminDefaultsForm">
        <label>Items per page
          <input id="adminItemsPerPage" name="adminItemsPerPage" type="number" min="1" value="20">
        </label>
        <label>
          <input id="adminEmailAlerts" name="adminEmailAlerts" type="checkbox" checked> Send email alerts to admins
        </label>
        <div style="margin-top:12px">
          <button id="saveAdminDefaults" class="btn">Save Admin Defaults</button>
        </div>
      </form>
    </section>
  </main>

  <script src="./script.js"></script>
  <script>
    // Minimal save handlers — delegate to `window.apiFetch` if available
    function postJson(path, body){
      if(typeof window.apiFetch === 'function') return window.apiFetch(path, { method: 'POST', body: JSON.stringify(body), headers:{'content-type':'application/json'} });
      return fetch(path, { method: 'POST', body: JSON.stringify(body), headers:{'content-type':'application/json'} }).catch(e=>{ console.warn('save failed', e); return null });
    }

    document.getElementById('saveAppSettings').addEventListener('click', async (ev)=>{
      ev.preventDefault();
      const body = {
        siteTitle: document.getElementById('siteTitle').value,
        defaultLang: document.getElementById('defaultLang').value,
        maintenanceMode: document.getElementById('maintenanceMode').checked,
        allowRegistration: document.getElementById('allowRegistration').checked
      };
      const res = await postJson('/api/admin/settings', body);
      if(res && res.ok) alert('App settings saved'); else alert('Save failed (check console)');
    });

    document.getElementById('saveAdminDefaults').addEventListener('click', async (ev)=>{
      ev.preventDefault();
      const body = {
        itemsPerPage: Number(document.getElementById('adminItemsPerPage').value)||20,
        emailAlerts: document.getElementById('adminEmailAlerts').checked
      };
      const res = await postJson('/api/admin/settings/admin-defaults', body);
      if(res && res.ok) alert('Admin defaults saved'); else alert('Save failed (check console)');
    });
  </script>
</body>
</html>
